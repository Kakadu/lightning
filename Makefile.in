lib: 
	$(MAKE) -C src $(LIB)

debug:
	$(MAKE) -C src debug

%.cmo: 
	$(MAKE) -C src $@


INSTALL_OPTS = 

BYTE_FILES = src/lightning.cma src/dlllightning.so src/liblightning.a
NATIVE_FILES = src/lightning.cmxa src/lightning.a src/liblightning.a
SYNTAX_FILES = src/syntax/pa_prop.cmo src/syntax/pa_debug.cmo
INSTALL_FILES = 

ifneq (,$(findstring byte,$(LIB)))
	INSTALL_FILES += $(BYTE_FILES)
	INSTALL_FILES += $(wildcard src/facebook/*.cma src/vkontakte/*.cma)
	INSTALL_FILES += $(wildcard src/facebook/*.so src/vkontakte/*.so)
endif

ifneq (,$(findstring native,$(LIB)))
	INSTALL_FILES += $(NATIVE_FILES)
	INSTALL_FILES += $(wildcard src/facebook/*.cmxa src/vkontakte/*.cmxa)
	INSTALL_FILES += $(wildcard src/facebook/*.a src/vkontakte/*.a)
endif

ifneq (,$(findstring syntax,$(LIB)))
	INSTALL_FILES += $(SYNTAX_FILES)
endif

install: lib 
	cp $(META) META
	sudo $(OCAMLFIND) install lightning META $(INSTALL_FILES) src/*.cmi src/*.mli src/containers/*.cmi src/containers/*.mli src/facebook/*.mli src/facebook/*.cmi src/vkontakte/*.cmi src/vkontakte/*.mli  $(INSTALL_OPTS) 

uninstall:
	sudo $(OCAMLFIND) remove lightning

reinstall: uninstall install

.PHONY: install uninstall reinstall 

doc:
	$(MAKE) -C src doc

clean: 
	$(MAKE) -C src clean
	$(MAKE) -C src/facebook clean
	$(MAKE) -C src/vkontakte clean

